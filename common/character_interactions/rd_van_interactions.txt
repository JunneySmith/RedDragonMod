governor_removal_interaction = {
	category = interaction_category_succession
	filter_tags = { admin_governor }
	icon = icon_governor_removal
	common_interaction = no
	desc = governor_removal_interaction_desc
	greeting = negative
	notification_text = GOVERNOR_REMOVAL_NOTIFICATION_TEXT
	popup_on_receive = yes
	pause_on_receive = yes
	cooldown_against_recipient = { years = 5 }

	auto_accept = yes

	is_shown = {
		scope:actor = {
			top_liege = this
			OR = {
			government_allows = administrative
			has_government = rd_han_administrative_government
			}
		}
		scope:recipient = {
			this != scope:actor
			is_governor = yes
			is_vassal_of = scope:actor
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			NOT = { is_at_war_with = scope:recipient }
			any_vassal = {
				is_governor = yes
				this != scope:actor
			}
			is_imprisoned = no
		}
		scope:recipient = {
			trigger_if = {
				limit = {
					top_liege = {
						has_realm_law_flag = celestial_retirement_law
					}
				}
				tgp_is_above_retirement_age_trigger = {
					REALM_OWNER = scope:recipient
				}
			}
		}
	}

	is_highlighted = {
		scope:recipient ?= {
			any_held_title = {
				current_heir ?= {
					OR = {
						scope:actor ?= this
						is_close_family_of = scope:actor
					}
				}
			}
		}
	}

	highlighted_reason = HIGHLIGHTED_GOVERNOR_REMOVAL_HEIR

	can_send = {
		scope:recipient != scope:actor
		custom_tooltip = {
			text = demand_governor_removal_dominant_family_tt
			scope:recipient.house ?= { is_dominant_family = no }
		}
	}

	cost = {
		influence = {
			value = 0
			if = {
				limit = { exists = scope:recipient }
				scope:recipient ?= {
					if = {
						limit = {
							any_held_title = {
								title_tier = kingdom
								is_landless_type_title = no
								is_noble_family_title = no
							}
						}
						add = {
							every_held_title = {
								title_tier = kingdom
								limit = {
									is_landless_type_title = no
									is_noble_family_title = no
								}
								add = {
									value = scope:recipient.massive_influence_value
									multiply = 3
								}
							}
							desc = GOVERNOR_RESIGNATION_KINGDOM_COST
						}
					}
					else_if = {
						limit = {
							any_held_title = {
								title_tier = duchy
								is_landless_type_title = no
								is_noble_family_title = no
							}
						}
						add = {
							every_held_title = {
								title_tier = duchy
								limit = {
									is_landless_type_title = no
									is_noble_family_title = no
								}
								add = scope:recipient.massive_influence_value
							}
							desc = GOVERNOR_RESIGNATION_DUCHY_COST
						}
					}
					if = {
						limit = { house ?= { is_powerful_family = yes } }
						add = {
							value = scope:recipient.massive_influence_value
							desc = GOVERNOR_RESIGNATION_POWERFUL_COST
						}
					}
					else_if = {
						limit = { house ?= { is_dominant_family = yes } }
						add = {
							value = scope:recipient.monumental_influence_value
							desc = GOVERNOR_RESIGNATION_DOMINANT_COST
						}
					}
					if = {
						limit = {
							scope:actor = { is_ai = no } # This cost is only for players due to performance reasons
						}
						if = {
							limit = {
								scope:recipient.governor_efficiency != 1
							}
							add = {
								value = -100
								add = {
									value = scope:recipient.governor_efficiency
									multiply = 100
								}
								desc = GOVERNOR_RESIGNATION_EFFICIENCY_COST
							}
						}
					}
					if = {
						limit = {
							influence_level != 1
						}
						add = {
							value = {
								value = influence_level
								subtract = 1
							}
							multiply = 50
							desc = GOVERNOR_RESIGNATION_INFLUENCE_LEVEL_COST
						}
					}
				}
				scope:actor = {
					if = {
						limit = { has_revoke_title_reason = scope:recipient }
						multiply = {
							value = 0.5
							desc = temporal_condemnation_got_revoke_reason # Reused loc
						}
					}
				}
				scope:recipient = {
					if = {
						limit = { tgp_is_above_retirement_age_trigger = { REALM_OWNER = scope:recipient } }
						multiply = {
							value = 0.05
							desc = recipient_above_retirement_age_desc
						}
					}
				}
			}
		}
	}

	on_accept = {
		scope:actor = {
			if = {
				limit = {
					scope:recipient = { tgp_is_above_retirement_age_trigger = { REALM_OWNER = scope:recipient } }
				}
				save_scope_value_as = {
					name = force_retirement_treasury_cost
					value = scope:recipient.medium_gold_value
				}
				pay_treasury_to_gold = {
					target = scope:recipient
					value = scope:force_retirement_treasury_cost
				}
			}
		}
		scope:recipient = {
			if = {
				limit = {
					house ?= {
						OR = {
							is_powerful_family = yes
							is_dominant_family = yes
						}
					}
					can_set_relation_rival_trigger = { CHARACTER = scope:actor }
				}
				progress_towards_rival_effect = {
					REASON = rival_deposed_governor
					CHARACTER = scope:actor
					OPINION = 0
				}
			}
			add_opinion = {
				target = scope:actor
				modifier = demanded_my_resignation_opinion
			}
			custom_tooltip = demanded_my_resignation_house_tt
			hidden_effect = {
				house ?= {
					if = {
						limit = {
							this != scope:actor.house
						}
						every_house_member = {
							custom = custom.every_house_member_secondary_recipient
							limit = {
								is_ai = yes
								this != scope:recipient
							}
							if = {
								limit = {
									house = {
										OR = {
											is_powerful_family = yes
											is_dominant_family = yes
										}
									}
								}
								add_opinion = {
									target = scope:actor
									modifier = demanded_my_house_members_resignation_opinion
									opinion = -20
								}
							}
							else = {
								add_opinion = {
									target = scope:actor
									modifier = demanded_my_house_members_resignation_opinion
									opinion = -15
								}
							}
						}
					}
				}
			}
			if = {
				limit = {
					any_held_title = {
						is_noble_family_title = no
						current_heir ?= {
							NOR = {
								this = scope:actor
								AND = {
									exists = scope:recipient.house
									house ?= scope:recipient.house
								}
								has_relation_friend = scope:recipient
								has_relation_best_friend = scope:recipient
								is_allied_to = scope:recipient
								has_relation_soulmate = scope:recipient
								is_spouse_of = scope:recipient
								is_close_family_of = scope:recipient
							}
							opinion = {
								target = scope:recipient
								value <= 40
							}
						}
					}
				}
				every_held_title = {
					limit = {
						is_noble_family_title = no
						current_heir ?= {
							NOR = {
								this = scope:actor
								AND = {
									exists = scope:recipient.house
									house ?= scope:recipient.house
								}
								has_relation_friend = scope:recipient
								has_relation_best_friend = scope:recipient
								is_allied_to = scope:recipient
								has_relation_soulmate = scope:recipient
								is_spouse_of = scope:recipient
								is_close_family_of = scope:recipient
							}
							opinion = {
								target = scope:recipient
								value <= 40
							}
						}
					}
					current_heir = {
						add_to_list = deposed_title_heirs
					}
				}
				every_in_list = {
					list = deposed_title_heirs
					add_opinion = {
						target = scope:actor
						modifier = deposed_predecessor_opinion
					}
				}
			}
			trigger_event = ep3_interactions_events.0630
			show_as_tooltip = {
				governor_resignation_title_transfer_effect = yes
			}
		}
	}

	on_decline = {
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = demanded_my_resignation_opinion
			}
		}
		scope:actor = {
			send_interface_toast = {
				title = demand_governor_resignation_declined_toast
				type = event_toast_effect_bad
				left_icon = scope:recipient
				revocation_tyranny_effect = { VASSAL = scope:recipient }
				title_revocation_stress_effect = { VASSAL = scope:recipient }
			}
		}
		war_for_revoke_effect = {
			LIEGE = scope:actor
			REBEL = scope:recipient
		}
		scope:actor = {
			if = {
				limit = { has_realm_law_flag = vassal_refusal_is_treason }
				add_opinion = {
					target = scope:recipient
					modifier = treasonous_revoke_refusal
				}
			}
		}
	}

	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
		}
		flag = hook
		localization = GENERIC_SPEND_A_HOOK
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	send_options_exclusive = no

	can_be_blocked = {
		custom_description = { #Hook from Recipient can counteract, but only if Actor is not forcing the action via Strong Hook.
			text = "spending_hook"
			subject = scope:recipient
			object = scope:actor
			scope:recipient = { has_hook = scope:actor }
			NAND = {
				scope:hook = yes
				scope:actor = { has_strong_hook = scope:recipient }
			}
		}
	}

	on_blocked_effect = {
		scope:recipient = {
			remove_hook = { target = scope:actor }
		}
	}

	# AI
	ai_targets = {
		ai_recipients = vassals
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 36
		duchy = 6
		kingdom = 6
		empire = 6
		hegemony = 6
	}
	ai_potential = {
		influence > massive_influence_value
		is_at_war = no # Don't spend influence when at war in case troops are needed
	}

	ai_will_do = {
		base = -10
		modifier = {
			scope:actor.house = scope:recipient.house
			add = -50
		}
		modifier = {
			scope:actor = { has_relation_rival = scope:recipient }
			add = 30
		}
		modifier = { # Get rid of bad governors, but there is no point if the heir is worse
			scope:recipient = {
				governor_efficiency <= 0.7
				governor_efficiency < scope:recipient.primary_heir.governor_efficiency
			}
			add = 10
		}
		modifier = {
			scope:recipient = {
				is_a_faction_member = yes
			}
			add = 20
		}
		modifier = {
			scope:recipient = {
				governor_efficiency >= 1.25
			}
			add = -10
		}
		modifier = {
			scope:recipient = {
				has_trait = loyal
			}
			add = -10
		}
		modifier = {
			scope:recipient = {
				has_trait = disloyal
			}
			add = 5
		}
		modifier = {
			scope:recipient = {
				is_allied_to = scope:actor
			}
			add = -100
		}
		modifier = {
			scope:recipient = {
				any_held_title = {
					current_heir ?= {
						house = scope:actor.house
						this != scope:actor
					}
				}
			}
			add = 10
		}
		opinion_modifier = { # Opinion Factor
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = -0.25
		}
	}
}

influence_meritorious_career_interaction = {
	icon = support_candidacy
	category = interaction_category_succession
	common_interaction = yes
	interface_priority = 100

	desc = influence_meritorious_career_interaction_desc

	is_shown = {
		scope:actor = {
			OR = {
			has_government = rd_han_administrative_government
			government_allows = administrative
			}
			government_has_flag = government_has_merit
		}
		scope:recipient = {
			OR = {
				AND = {
					government_allows = administrative
					government_has_flag = government_has_merit
				}
				is_ruler = no
			}
			top_liege = scope:actor.top_liege
			this != top_liege
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			influence >= 0
			OR = {
				is_landed_or_landless_administrative = yes
				OR = {
					has_title = title:e_minister_chancellor
					has_title = title:e_minister_censor
					has_title = title:e_minister_grand_marshal
					has_title = title:e_minister_of_personnel
					has_title = title:e_minister_of_revenue
					has_title = title:e_minister_of_rites
					has_title = title:e_minister_of_war
					has_title = title:e_minister_of_justice
					has_title = title:e_minister_of_works
				}
			}
			is_adult = yes
		}
		scope:recipient = {
			is_adult = yes
			trigger_if = {
				limit = {	
					is_female = yes
				}
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					top_liege ?= {	
						NOR = {
							has_realm_law = male_only_law
							has_realm_law = male_preference_law
						}
					}
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					top_liege ?= {	
						NOR = {
							has_realm_law = female_only_law
							has_realm_law = female_preference_law
						}
					}
				}
			}
		}			
	}

	can_send = {
	}

	# There's no real reason for the AI to refuse
	auto_accept = yes

	send_option = {
		flag = major_influence_option
		localization = "major_influence_option_desc"
		starts_enabled = {
			scope:actor = { influence >= career_score_major_cost_value }
		}
	}
	send_option = {
		flag = medium_influence_option
		localization = "medium_influence_option_desc"
		starts_enabled = {
			scope:actor = {
				influence < career_score_major_cost_value
				influence >= career_score_medium_cost_value
			}
		}
	}
	send_option = {
		flag = minor_influence_option
		localization = "minor_influence_option_desc"
		starts_enabled = {
			scope:actor = { influence < career_score_medium_cost_value }
		}
	}

	localization_values = {
		MAJOR_INFLUENCE_OPTION = scope:actor.career_score_major_total_value
		MEDIUM_INFLUENCE_OPTION = scope:actor.career_score_medium_total_value
		MINOR_INFLUENCE_OPTION = scope:actor.career_score_minor_total_value
	}

	cost = {
		influence = {
			# Base cost
			switch = {
				trigger = yes
				scope:major_influence_option = {
					add = {
						value = career_score_major_cost_value
						desc = BASE
					}
				}
				scope:medium_influence_option = {
					add = {
						value = career_score_medium_cost_value
						desc = BASE
					}
				}
				scope:minor_influence_option = {
					add = {
						value = career_score_minor_cost_value
						desc = BASE
					}
				}
			}

			save_temporary_value_as = calculated_base_cost

			# Movement leaders have a small reduction bonus
			if = {
				limit = {
					scope:actor = { is_any_movement_leader = yes }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.1
					desc = you_are_a_movement_leader_desc
				}
			}

			# Ministers
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_chancellor }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.2
					desc = you_are_the_grand_chancellor_desc
				}
			}
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_of_personnel }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.1
					desc = you_are_the_minister_of_personnel_desc
				}
			}

			# A dominant family gets to spend less influence
			if = {
				limit = {
					scope:actor.house ?= { is_dominant_family = yes }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.2
					desc = "[dominant_family|E]"
				}
			}
			
			# House Aspiration
			if = {
				limit = {
					scope:actor.house ?= {
						OR = {
							has_house_power_parameter = influence_career_bonus_1
							has_house_power_parameter = influence_career_bonus_2
						}
					}
					#scope:recipient.house ?= scope:actor.house
				}
				add = {
					value = scope:calculated_base_cost
					multiply = {
						scope:actor.house = {
							if = {
								limit = { has_house_power_parameter = influence_career_bonus_2 }
								add = influence_career_bonus_2_value
							}
							else_if = {
								limit = { has_house_power_parameter = influence_career_bonus_1 }
								add = influence_career_bonus_1_value
							}
						}
					}
					desc = celestial_traditional_name_desc
				}
			}

			# Dynasty Legacy
			if = {
				limit = {
					scope:actor = {
						dynasty ?= {
							has_dynasty_perk = tgp_chinese_legacy_5
						}
					}
				}
				add = {
					value = scope:calculated_base_cost
					multiply = dynasty_legacy_influence_career_discount_value
					desc = court_position_tgp_dynasty_legacy
				}
			}
		}
	}

	on_accept = {
		switch = {
			trigger = yes
			scope:major_influence_option = {
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_major_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 15
				}
			}
			scope:medium_influence_option = {
				# Save the score value
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_medium_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 10
				}
			}
			scope:minor_influence_option = {
				# Save the score value
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_minor_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 5
				}
			}
		}

		# Update the score for the target character
		scope:recipient = {
			hidden_effect = {
				if = {
					limit = {
						is_military_candidate_trigger = yes
					}
					if = {
						limit = {
							has_variable = merit_military_career_score_bonus
						}
						change_variable = {
							name = merit_military_career_score_bonus
							add = scope:increased_career_score
						}
					}
					else = {
						set_variable = {
							name = merit_military_career_score_bonus
							value = scope:increased_career_score
						}
					}
				}
				else = {
					if = {
						limit = {
							has_variable = merit_civilian_career_score_bonus
						}
						change_variable = {
							name = merit_civilian_career_score_bonus
							add = scope:increased_career_score
						}
					}
					else = {
						set_variable = {
							name = merit_civilian_career_score_bonus
							value = scope:increased_career_score
						}
					}
				}
			}
			# Display the relevant information
			if = {
				limit = {
					is_military_candidate_trigger = yes
				}
				custom_tooltip = influence_meritorious_career_effect_military_desc
			}
			else = {
				custom_tooltip = influence_meritorious_career_effect_civilian_desc
			}
			custom_tooltip = influence_meritorious_career_effect_warning_desc
		}
	}

	ai_targets = {
		ai_recipients = self
		ai_recipients = liege
	}
	ai_targets = {
		ai_recipients = family
		max = 10
	}
	ai_targets = {
		ai_recipients = peer_vassals
		max = 10
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 42
		duchy = 30
		kingdom = 18
		empire = 12
		hegemony = 6
	}

	ai_potential = {
		government_allows = merit
		influence >= monumental_influence_value # Only consider doing this if you have the influence to spare
		OR = {
			is_landed_or_landless_administrative = yes
			highest_held_title_tier >= tier_empire
		}
	}

	ai_will_do = {
		base = -10

		# Opinion
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = 0.5
			trigger = { scope:actor != scope:recipient }
		}

		# Family relations
		modifier = {
			add = 25
			exists = scope:recipient.house
			house ?= scope:recipient.house
		}
		modifier = {
			add = 20
			is_close_family_of = scope:recipient
		}

		# Other relations
		modifier = {
			add = 20
			has_relation_disciple = scope:recipient
		}
		modifier = {
			add = 20
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}
		modifier = {
			add = 10
			is_in_same_movement_as = { TARGET = scope:recipient }
		}

		# Less useful if recipient is a governor already already
		modifier = {
			add = -50
			scope:recipient = { is_governor = yes }
		}

		# Don't do it at all towards empire tier characters - they cannot get a higher position anyway
		modifier = {
			factor = 0
			scope:recipient = { highest_held_title_tier >= tier_empire }
		}
	}
}

demand_admin_interaction = {
	category = interaction_category_vassal
	icon = demand_admin_interaction

	ai_maybe = yes
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	can_send_despite_rejection = yes
	ai_accept_negotiation = yes
	popup_on_receive = yes
	common_interaction = no

	#according to telemetry, practically never used
	interface_priority = 0

	ai_targets = {
		ai_recipients = vassals
	}
	ai_target_quick_trigger = {
		adult = yes
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 12
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:actor = { government_has_flag = government_is_japan_administrative }
				}
				desc = demand_admin_interaction_desc_japan
			}
			desc = demand_admin_interaction_desc
		}
	}

	is_shown = {
		scope:actor = {
			OR = {
			government_allows = administrative
			
			government_has_flag = government_is_celestial
			}
			trigger_if = {
				limit = { is_ai = yes }
				scope:recipient = { highest_held_title_tier >= tier_county }
			}
		}
		scope:recipient = {
			target_is_liege_or_above = scope:actor
			is_ai = yes
			is_landed = yes
			is_ruler = yes
			trigger_if = {
				limit = {
					scope:actor = {
						government_has_flag = government_is_administrative
					}
				}
				NOT = { government_has_flag = government_is_administrative }
			}
			trigger_else_if = {
				limit = {
					scope:actor = {
						government_has_flag = government_is_celestial
					}
				}
				NOT = { government_has_flag = government_is_celestial }
			}
			trigger_else_if = {
				limit = {
					scope:actor = {
						government_has_flag = government_is_japan_administrative
					}
				}
				NOT = { government_has_flag = government_is_japan_administrative }
			}
			trigger_else_if = {
				limit = {
					scope:actor = {
						government_has_flag = government_has_merit
					}
				}
				NOT = { government_has_flag = government_has_merit }
			}
			trigger_else = {
				NOT = { government_has_flag = government_is_steppe_admin }
			}
		}
	}

	cooldown_against_recipient = { years = 10 }

	is_valid_showing_failures_only = {
		scope:recipient = {
			NOT = { has_strong_hook = scope:actor }
			is_at_war = no
			trigger_if = {
				limit = {
					is_landed = no
					exists = domicile
				}
				domicile.domicile_location.county.holder = { government_allows = administrative }
			}
			trigger_if = {
				limit = { exists = confederation }
				NOT = { scope:actor.confederation ?= confederation }
			}
			liege = scope:actor
		}
		scope:actor = { is_at_war = no }
		custom_tooltip = {
			text = cannot_take_overt_hostile_actions_against_diarch.tt
			NOT = { scope:recipient ?= scope:actor.diarch }
		}
		custom_tooltip = {
			text = demand_admin_tribal
			NOT = {
				scope:recipient = { government_has_flag = government_is_tribal }
			}
		}
		custom_tooltip = {
			text = head_of_faith_unable_to_change_government_desc
			NOT = {
				scope:recipient = { faith.religious_head ?= this }
			}
		}
	}

	# Offer hereditary boost
	send_option = {
		is_valid = {
			scope:recipient = { is_landed = yes }
			custom_tooltip = {
				text = demand_admin_hereditary_tt
				scope:recipient.house ?= {
					any_house_member = { count > 1 }
				}
			}
			custom_tooltip = {
				text = demand_admin_hereditary_exists_tt
				NOT = { exists = scope:recipient.primary_title.var:petition_house_rights }
			}
		}
		flag = hereditary
		localization = demand_admin_hereditary
	}
	#Spend influence
	send_option = {
		flag = influence
		is_valid = {
			scope:actor.influence >= massive_influence_value
		}
		localization = SPEND_INFLUENCE
	}
	#Use hook
	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
		}
		flag = hook
		localization = SCHEME_HOOK
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	send_options_exclusive = no

	auto_accept = {
		custom_description = {
			text = "spending_hook"
			subject = scope:actor
			object = scope:recipient
			scope:hook = yes
		}
	}

	on_send = {
		scope:recipient = {
			primary_title = { save_scope_as = demanded_administration }
			trigger_event = {
				id = ep3_interactions_events.0005
				days = 5
			}
		}
	}

	on_accept = {
		show_as_tooltip = {
			change_to_administrative_interaction_effect = yes
		}
		if = {
			limit = {
				scope:recipient = { is_ai = yes }
			}
			scope:recipient = {
				set_variable = {
					name = demand_admin_accepted_ai_block
					value = scope:actor
					years = 10
				}
			}
		}
	}

	on_decline = {
		# In Japan, this starts a war
		if = {
			limit = {
				scope:actor = { government_has_flag = government_is_japan_administrative }
				scope:recipient = {
					is_landed = yes
					government_has_flag = government_is_japan_feudal
				}
			}
			tgp_japan_demand_administrative_refusal_effect = yes
		}
		# Elsewhere it does not
		else = {
			scope:recipient = { custom_tooltip = demand_admin_interaction_vassal_refuses }
		}
	}

	ai_potential = {
		government_allows = administrative
		is_adult = yes
	}

	ai_will_do = {
		base = 100
		modifier = {
			factor = 0
			scope:recipient = { highest_held_title_tier >= tier_county }
			gold >= 300
		}
		modifier = {
			factor = 0
			scope:recipient = { highest_held_title_tier >= tier_duchy }
			gold >= 600
		}
		modifier = {
			factor = 0
			scope:recipient = { highest_held_title_tier >= tier_kingdom }
			gold >= 2000
		}
	}

	ai_accept = {
		base = 0
		japan_demand_admin_acceptance_modifier = yes
		demand_admin_acceptance_modifier = yes
	}
}



grant_governorship_interaction = {
	icon = grant_governorship
	category = interaction_category_vassal
	common_interaction = yes

	desc = grant_governorship_interaction_desc

	special_interaction = grant_governorship_interaction
	interface = grant_titles
	target_type = title
	target_filter = actor_domain_titles
	interface_priority = 60

	# actor character giving the titles
	# recipient character receiving the titles

	is_shown = {
		scope:actor != scope:recipient
		scope:recipient = {
			OR = {
				target_is_liege_or_above = scope:actor
				is_pool_guest_of = scope:actor
			}
		}
		scope:actor = {
			OR = {
			has_government = rd_han_administrative_government
			government_allows = administrative
			}
			highest_held_title_tier >= tier_county
		}

		trigger_if = {
			limit = {
				scope:actor = { is_ai = yes }
			}
			scope:recipient = {
				NOT = { any_parent = { is_ai = no } }
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			custom_tooltip = {
				text = grant_governorship_interaction_no_title_tt
				any_held_title = {
					tier >= tier_county
					is_noble_family_title = no
					is_landless_type_title = no
					NOR = {
						this = scope:actor.capital_county
						this = scope:actor.primary_title
					}
				}
			}
		}
		scope:recipient = {
			is_adult = yes
			NOT = { is_at_war_with = scope:actor }
			bp2_valid_for_standard_interactions_trigger = yes
			trigger_if = {
				limit = { is_ruler = no }
				is_imprisoned = no
			}
			OR = {
			government_allows = administrative
			is_ruler = no
			}
			# Only the preferred gender can be appointed unless they hold titles already
			trigger_if = {
				limit = {
					scope:actor = {
						OR = {
							has_realm_law = male_only_law
							has_realm_law = male_preference_law
						}
					}
					is_landed = no
				}
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					is_female = no
				}
			}
			trigger_if = {
				limit = {
					scope:actor = {
						OR = {
							has_realm_law = female_only_law
							has_realm_law = female_preference_law
						}
					}
					is_landed = no
				}
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					is_female = yes
				}
			}
			# DON'T TAKE OTHER PLAYERS' ACCLAIMED KNIGHTS
			custom_description = {
				text = grant_title_stealing_acclaimed_knight
				subject = scope:recipient
				NOR = {
					AND = {
						is_acclaimed = yes
						liege ?= {
							is_ai = no
							this != scope:actor
						}
					}
					AND = {
						is_acclaimed = yes
						scope:actor = { is_ai = yes }
					}
				}
			}
			is_clergy = no
			# Gallivanters won't accept additional responsibilities.
			NOT = { has_trait = gallivanter }
			# TGP JAPAN
			tgp_japan_grant_titles_restriction_trigger = {
				GRANTER = scope:actor
				GRANTEE = scope:recipient
			}
			# Cannot be a minister
			custom_tooltip = {
				text = recipient_is_a_minister_desc
				tgp_is_any_minister = no
			}
		}
	}

	can_send = {
		scope:recipient = {
			custom_tooltip = {
				text = promote_candidate_interaction_existing_holder_tt
				this != scope:target.holder
			}

			trigger_if = { # Governors can only be appointed to certain titles
				limit = {
					is_governor = yes
					scope:target = { is_noble_family_title = no } # For tooltip reasons, so we don't show more than necessary
				}
				custom_tooltip = { # Only one province of highest rank
					text = only_one_province_of_highest_rank_tt
					NAND = {
						highest_held_title_tier = scope:target.tier
						scope:target.tier >= tier_duchy
						scope:target = { # We make an exception if recipient controls at least one de jure county
							any_de_jure_county = {
								count < 1
								OR = {
									holder = scope:recipient
									holder = { is_vassal_or_below_of = scope:recipient }
								}
							}
						}
					}
				}
				custom_tooltip = {
					text = admin_must_be_de_jure_or_neighboring
					any_held_title = {
						OR = {
							# The target title is part of your de jure structure
							is_de_jure_liege_or_above_target = scope:target
							target_is_de_jure_liege_or_above = scope:target
							# Or is a neighboring county which de jure duchy is not part of your realm
							AND = {
								any_title_to_title_neighboring_county = { this = scope:target }
								scope:target = {
									tier = tier_county
									duchy = {
										OR = {
											NOT = { exists = holder }
											holder = {
												NOR = {
													is_vassal_or_below_of = scope:actor
													this = scope:actor
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			trigger_if = { # If recipient is landless and only have a family title, target title must be a duchy or above
				limit = {
					is_landless_ruler = yes
					any_held_title = { is_noble_family_title = yes }
					scope:target.tier < min_appointment_tier
				}
				primary_title.tier <= scope:target.tier
			}
			trigger_if = { # If recipient is a count, they can get only get counties within the same duchy
				limit = {
					highest_held_title_tier = tier_county
					main_administrative_tier > tier_county
					is_landed = yes
					scope:target.tier = tier_county
				}
				custom_tooltip = {
					text = admin_count_grant_only_counties
					any_held_title = { duchy = scope:target.duchy }
				}
			}
			tgp_is_ceremonial_liege_trigger = no
		}
	}

	can_be_picked_title = {
		scope:target = {
			is_leased_out = no

			scope:recipient = {
				trigger_if = { # Governors can only be appointed to certain titles
					limit = {
						is_governor = yes
						scope:target = { is_noble_family_title = no } # For tooltip reasons, so we don't show more than necessary
					}
					custom_tooltip = { # Only one province of highest rank
						text = only_one_province_of_highest_rank_tt
						NAND = {
							highest_held_title_tier = scope:target.tier
							scope:target.tier >= main_administrative_tier
							trigger_if = {
								limit = {
									scope:target.tier >= tier_duchy
								}
								scope:target = { # We make an exception if recipient controls at least one de jure county
									any_de_jure_county = {
										count < 1
										OR = {
											holder = scope:recipient
											holder = { is_vassal_or_below_of = scope:recipient }
										}
									}
								}
							}
						}
					}
					custom_tooltip = {
						text = admin_must_be_de_jure_or_neighboring
						any_held_title = {
							OR = {
								# The target title is part of your de jure structure
								is_de_jure_liege_or_above_target = scope:target
								target_is_de_jure_liege_or_above = scope:target
								# Or is a neighboring county which de jure duchy is not part of your realm
								AND = {
									any_title_to_title_neighboring_county = { this = scope:target }
									scope:target = {
										tier = tier_county
										duchy = {
											OR = {
												NOT = { exists = holder }
												holder = {
													NOR = {
														is_vassal_or_below_of = scope:actor
														this = scope:actor
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				trigger_if = { # If recipient is landless and only have a family title, target title must be a duchy or above
					limit = {
						is_landless_ruler = yes
						any_held_title = { is_noble_family_title = yes }
						scope:target.tier < min_appointment_tier
					}
					primary_title.tier <= scope:target.tier
				}
				trigger_if = { # If recipient is a count, they can get only get counties within the same duchy
					limit = {
						highest_held_title_tier = tier_county
						main_administrative_tier > tier_county
						is_landed = yes
						scope:target.tier = tier_county
					}
					custom_tooltip = {
						text = admin_count_grant_only_counties
						any_held_title = { duchy = scope:target.duchy }
					}
				}
				tgp_is_ceremonial_liege_trigger = no
			}

			custom_tooltip = {
				text = GRANT_TITLES_ITEM_CANT_GIVE_ADMIN_PRIMARY
				this != scope:actor.capital_province.duchy
			}

			trigger_if = {
				limit = { is_noble_family_title = yes }
				custom_tooltip = {
					text = GRANT_TITLES_ITEM_CANT_GIVE_NOBLE_FAMILY
					always = no
				}
			}

			trigger_if = {
				limit = {
					list_size:target_titles > 0
				}
				custom_tooltip = {
					text = GRANT_TITLES_ITEM_ADMIN_CANT_GIVE_MORE_THAN_ONE
					any_in_list = {
						list = target_titles
						scope:target ?= this
					}
				}
			}

			trigger_if = {
				limit = { scope:target = title:k_fashion }
				NOT = { scope:target = title:k_fashion }
			}
		}

		custom_description = {
			text = grant_titles_interaction_can_only_give_diarch_de_jure_liege_to_diarch
			subject = scope:actor.diarch
			NAND = {
				# Only applies if we have an active diarchy.
				scope:actor = { has_active_diarchy = yes }
				# Now, prevent us from giving away our diarch's land to invalidate them...
				scope:target = {
					any_dejure_vassal_title_holder = { this = scope:actor.diarch }
					# ... _unless_ we're giving it _to_ the diarch.
					scope:recipient != scope:actor.diarch
					# Plus we only care if the title is below our tier.
					tier < scope:actor.highest_held_title_tier
				}
			}
		}

		custom_description = {
			text = grant_titles_interaction_title_being_wagered
			NOT = {
				scope:target = { has_variable = wagered_county }
			}
		}
	}

	auto_accept = yes

	on_auto_accept = {
		scope:recipient = {
			trigger_event = {
				id = char_interaction.0111
				delayed = yes #this has to be delayed in case you grant it to someone that doesn't have an estate yet, for the change_government effect to work and generate the estate
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				any_in_list = {
					list = target_titles
					tier >= tier_county
				}
				scope:recipient = {
					is_ruler = no
				}
				scope:actor = {
					OR = {
					government_has_flag = government_is_rd_han_administrative
					has_government = rd_celestial_empire_government
					}
				}
			}
			scope:recipient = {
				change_to_administrative_effect = yes
			}
		}
		if = {
			limit = {
				NOT = {any_in_list = {
					list = target_titles
					tier >= tier_county
				}
				}
				scope:recipient = {
					is_ruler = no
				}
				scope:actor = {
					OR = {
					government_has_flag = government_is_rd_han_administrative
					has_government = rd_celestial_empire_government
					}
				}
			}
			scope:recipient = {
				change_government = celestial_government
			}
		}
		if = {
			limit = {
				scope:recipient = {
					is_acclaimed = yes
					liege = {
						this = scope:actor
					}
				}
			}
			custom_tooltip = grant_title_landing_acclaimed_knight_warning
		}

		if = {
			limit = {
				any_in_list = {
					list = target_titles
					tier >= tier_duchy
					title_capital_county = {
						culture != scope:actor.culture
						culture = scope:recipient.culture
					}
					NOT = {
						recent_history = {
							type = granted
							years = 10
						}
					}
				}
			}
			scope:recipient.culture = {
				change_cultural_acceptance = {
					target = scope:actor.culture
					value = grant_title_cultural_acceptance_impact
					desc = cultural_acceptance_gain_granted_title
				}
			}
		}
		if = {
			limit = {
				any_in_list = {
					list = target_titles
					tier >= tier_county
				}
				scope:actor.culture = { has_cultural_parameter = landing_house_members_give_prestige }
				exists = scope:actor.house
				exists = scope:recipient.house
				scope:actor.house = scope:recipient.house
			}
			scope:actor = {
				add_prestige = {
					value = 0
					every_in_list = {
						list = target_titles
						limit = { tier = tier_empire }
						add = massive_prestige_gain
					}
					every_in_list = {
						list = target_titles
						limit = { tier = tier_kingdom }
						add = major_prestige_gain
					}
					every_in_list = {
						list = target_titles
						limit = { tier = tier_duchy }
						add = medium_prestige_gain
					}
				}
			}
		}
		if = {
			limit = {
				any_in_list = {
					list = target_titles
					tier >= tier_county
				}
				scope:actor.culture = { has_cultural_parameter = landing_house_members_gives_renown }
				exists = scope:actor.house
				exists = scope:recipient.house
				scope:actor.house = scope:recipient.house
			}
			scope:actor.dynasty = {
				add_dynasty_prestige = {
					value = 0
					every_in_list = {
						list = target_titles
						limit = { tier = tier_kingdom }
						add = major_dynasty_prestige_gain
					}
					every_in_list = {
						list = target_titles
						limit = { tier = tier_duchy }
						add = medium_dynasty_prestige_gain
					}
				}
			}
		}

		# Iterate over all given titles
		#  - Add opinion modifiers
		#  - Collect titles that discontent reduction can later be derived from
		every_in_list = {
			list = target_titles
			save_temporary_scope_as = this_title
			if = {
				limit = {
					exists = scope:landed_title
				}
				scope:recipient = {
					if = {
						limit = {
							scope:this_title.tier = tier_duchy
						}

						hidden_effect = {
							add_opinion = {
								target = scope:actor
								modifier = received_title_duchy
							}
							if = {
								limit = {
									is_lowborn = yes
								}
								scope:actor = {
									every_vassal = {
										vassal_stance = courtly
										add_opinion = {
											target = scope:actor
											modifier = courtly_lowborn_grant_opinion
											opinion = -10	#less than usual because admin realms are more tolerant of bureaucratic "new" nobility
										}
									}
								}
							}
						}

						scope:this_title = { add_to_temporary_list = titles_to_grant }
					}

					else_if = {
						limit = {
							scope:this_title.tier = tier_kingdom
						}

						hidden_effect = {
							add_opinion = {
								target = scope:actor
								modifier = received_title_kingdom
							}
							if = {
								limit = {
									is_lowborn = yes
								}
								scope:actor = {
									every_vassal = {
										vassal_stance = courtly
										add_opinion = {
											target = scope:actor
											modifier = courtly_lowborn_grant_opinion
											opinion = -30	#less than usual because admin realms are more tolerant of bureaucratic "new" nobility
										}
									}
								}
							}
						}

						scope:this_title = { add_to_temporary_list = titles_to_grant }
					}
				}

				#Promised a vassal this title they had a claim on (vassal.2901)
				if = {
					limit = {
						scope:actor = {
							exists = var:was_promised_title
							var:was_promised_title = scope:recipient
						}
					}
					if = {
						limit = {
							scope:recipient = {
								exists = var:promised_title
							}
							scope:landed_title = scope:recipient.var:promised_title
						}
						scope:actor = {
							trigger_event = {
								id = vassal.2910
								days = { 7 14 }
							}
						}
					}
				}
			}
			if = {
				limit = {
					scope:recipient = {
						has_trait = bastard
					}
				}
				custom_tooltip = grant_title_to_bastard_dynasty_warning
			}
		} # every_in_list

		# The accumulated discontent reduction of the recipient
		scope:recipient = {
			if = {
				limit = {
					is_a_faction_member = yes
				}
				add_joined_faction_discontent = grant_title_opinion_sum_discontent_calc
			}
		}

		if = {
			limit = {
				any_in_list = {
					list = target_titles
					tier = tier_kingdom
				}
			}
			custom_tooltip = grant_title_modifier_stack_kingdoms
		}
		if = {
			limit = {
				any_in_list = {
					list = titles_to_grant
					tier = tier_duchy
				}
			}
			custom_tooltip = grant_title_modifier_stack_duchies
		}
		if = {
			limit = {
				trigger_if = {
					limit = { scope:actor = { is_ai = yes } }
					scope:actor = {
						any_vassal = {
							vassal_stance = courtly
						}
					}
				}
				scope:recipient = {
					is_lowborn = yes
				}
				any_in_list = {
					list = titles_to_grant
					tier >= tier_county
				}
			}
			custom_tooltip = grant_title_modifier_courtly_lowborn_grant_penalty
		}
		if = {
			limit = {
				scope:recipient = { is_a_faction_member = yes }
			}
			custom_tooltip = grant_title_modifier_stack_discontent
		}

		# Jealousy check
		if = {
			limit = {
				any_in_list = {
					list = titles_to_grant
					any_claimant = { grant_title_rivalry_trigger = yes }
				}
			}
			hidden_effect = {
				random = {
					chance = 25
					ordered_in_list = {
						list = titles_to_grant
						limit = {
							any_claimant = { grant_title_rivalry_trigger = yes }
						}
						order_by = tier
						save_scope_as = claim_title
						ordered_claimant = {
							limit = { grant_title_rivalry_trigger = yes }
							order_by = primary_title.tier
							save_scope_as = claim_vassal
							if = {
								limit = {
									scope:recipient = { is_lowborn = yes }
								}
								scope:recipient = { save_scope_as = lowborn_scope }
							}
							else_if = {
								limit = {
									scope:recipient = { has_claim_on = scope:claim_title }
								}
								scope:recipient = { save_scope_as = claimant_scope }
							}
							scope:actor = {
								trigger_event = {
									id = bp1_yearly.8070
									days = 5
								}
							}
						}
					}
				}
			}
		}

		scope:actor = {
			# Maintenance for runestones
			if = {
				limit = {
					# Use expanded version if we have FP1.
					has_fp1_dlc_trigger = yes
					fp1_remove_stele_new_holder_trigger = {
						TITLE = scope:target
						PREVIOUS_HOLDER = scope:actor
						NEW_HOLDER = scope:recipient
					}
				}
				# Actually removed in fp1_other_decisions.0113
				custom_tooltip = runestone_grant_title_warning
			}
			else_if = {
				limit = {
					scope:target = {
						exists = var:ancestor_to_bury
						has_county_modifier = county_raised_runestone_modifier
					}
					NOT = { scope:recipient.dynasty = var:ancestor_to_bury.dynasty } #We only have to change something if the new holder is of a different dynasty
				}
				# Actually removed in religious_decision.0312
				custom_tooltip = runestone_grant_title_warning
			}

			if = {
				limit = {
					dynasty ?= { has_dynasty_perk = ep1_culture_legacy_3 }
					scope:recipient = {
						is_playable_character = no
						culture != scope:actor.culture
						any_in_list = {
							list = target_titles
							OR = {
								tier = tier_county
								tier = tier_barony
							}
							culture = scope:recipient.culture
						}
					}
				}
				if = {
					limit = {
						can_add_hook = {
							target = scope:recipient
							type = favor_hook
						}
					}
					add_hook = {
						type = favor_hook
						target = scope:recipient
					}
				}
			}

			#Feedback for actor
			hidden_effect = {
				if = {
					limit = {
						NOT = { exists = scope:recipient_is_independent }
						scope:recipient = {
							any_held_title = {
								title_tier > barony
								NOT = { is_in_list = target_titles }
							}
						}
					}
					set_variable = {
						name = lower_count
						value = {
							value = -1
							every_in_list = {
								list = target_titles
								limit = {
									NOT = { tier = scope:actor.highest_held_title_tier }
								}
								add = 1
							}
						}
					}
					save_scope_value_as = {
						name = equal_count
						value = {
							value = 0
							every_in_list = {
								list = target_titles
								limit = { tier = scope:actor.highest_held_title_tier }
								add = 1
							}
						}
					}
					ordered_in_list = {
						list = target_titles
						order_by = tier
						save_temporary_scope_as = loc_title
					}
					send_interface_toast = {
						type = event_toast_effect_neutral
						title = grant_governorship_interaction_notification
						left_icon = scope:recipient
						right_icon = scope:loc_title
						if = {
							limit = { scope:actor.var:lower_count ?= 0 }
							custom_tooltip = grant_governorship_interaction_notification_effect_2
						}
						else_if = {
							limit = {
								exists = scope:actor.var:lower_count
								scope:actor.var:lower_count > 1
							}
							custom_tooltip = grant_governorship_interaction_notification_effect_3
						}
						else_if = {
							limit = { scope:actor.var:lower_count ?= 1 }
							custom_tooltip = grant_governorship_interaction_notification_effect_4
						}
						else_if = {
							limit = {
								scope:equal_count >= 1
								scope:recipient.top_liege ?= scope:actor.top_liege
							}
							custom_tooltip = grant_titles_interaction_notification_effect_5
						}
						else = { custom_tooltip = grant_titles_interaction_notification_effect }
						if = {
							limit = {
								exists = dynasty
								is_diff_faith_or_culture_trigger = {
									CHAR = scope:recipient
									STATUS = involved
								}
								any_character_struggle = {
									involvement = involved
									has_struggle_phase_parameter = struggle_grant_titles_diff_faith_culture_gives_prestige
								}
							}
							dynasty = { add_dynasty_prestige = minor_dynasty_prestige_gain }
						}
						remove_variable = lower_count
					}
				}
			}
		}

		hidden_effect = {
			# Struggle Catalyst
			if = {
				limit = {
					scope:actor = {
						is_diff_faith_or_culture_trigger = {
							CHAR = scope:recipient
							STATUS = involved
						}
						any_character_struggle = {
							involvement = involved
							activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
								CATALYST = catalyst_grant_privilege_to_diff_faith_culture_vassal
								CHAR = scope:recipient
							}
						}
					}
				}
				scope:actor = {
					every_character_struggle = {
						involvement = involved
						limit = {
							activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
								CATALYST = catalyst_grant_privilege_to_diff_faith_culture_vassal
								CHAR = scope:recipient
							}
						}
						activate_struggle_catalyst = {
							catalyst = catalyst_grant_privilege_to_diff_faith_culture_vassal
							character = scope:actor
						}
					}
				}
			}
		}

		# Achievements.
		scope:actor = {
			if = {
				limit = {
					has_variable_list = candidate_a_knights_tale_achievement
					is_target_in_variable_list = {
						name = candidate_a_knights_tale_achievement
						target = scope:recipient
					}
				}
				set_global_variable = {
					name = finished_a_knights_tale_achievement
					value = yes
				}
			}
		}
		# TGP Catalyst - triggered in on_title_gain
		if = {
			limit = {
				title:h_china.holder ?= scope:actor
				any_in_list = {
					list = target_titles
					OR = {
						AND = {
							tier = tier_empire
							scope:recipient.merit_level < 7
						}
						AND = {
							tier = tier_kingdom
							scope:recipient.merit_level < 5
						}
						AND = {
							tier = tier_duchy
							scope:recipient.merit_level < 3
						}
						AND = {
							tier = tier_county
							scope:recipient.merit_level < 1
						}
					}
				}
			}
			show_as_tooltip = {
				situation:dynastic_cycle ?= {
					if = {
						limit = {
							situation_top_has_catalyst = catalyst_hegemon_appointing_low_merit_governor
							title:h_china.holder = scope:actor
						}
						trigger_situation_catalyst = {
							catalyst = catalyst_hegemon_appointing_low_merit_governor
							character = root
						}
					}
				}
			}
		}
	}
}

celestial_send_military_aid_interaction = {
	icon = icon_soldier_survivor
	interface_priority = 70
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_send_military_aid_interaction_desc
	
	filter_tags = { admin_governor }

	popup_on_receive = yes
	pause_on_receive = yes

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	cost = {
		influence = {
			value = {
				add = medium_influence_value
				desc = BASE
			}
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_of_war }
				}
				multiply = {
					value = 0.25
					desc = "[minister_of_war|E]"
				}
			}
		}
	}

	is_shown = {
		scope:actor = {
			OR = {
				# If you are the minister of war
				has_title = title:e_minister_of_war
				# Or if you are an independent admin ruler with military governors
				AND = {
					top_liege = this
					OR = {
					government_allows = administrative
					has_government = rd_han_administrative_government
					}
					government_allows = merit
				}
			}
		}
		scope:recipient = {
			top_liege = scope:actor.top_liege
			OR = {
				is_landed = yes
				has_title = title:e_minister_grand_marshal
			}
		}
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = celestial_request_military_aid_no_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					OR = {
						vassal_contract_has_flag = celestial_military_appointment
						vassal_contract_has_flag = meritocratic_military_appointment
					}
				}
			}
		}

		custom_tooltip = {
			text = celestial_request_military_aid_no_available_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:recipient
						MINISTER_OF_WAR = scope:actor
					}
				}
			}
		}

		scope:recipient = {
			is_at_war = yes # Has to be at war
			is_at_war_with_liege = no # But not with liege
			NOT = { is_at_war_with = scope:actor }
			# Has to be a war leader
			trigger_if = {
				limit = { is_at_war = yes }
				custom_description = {
					text = target_is_not_war_leader
					object = scope:recipient
					any_character_war = {
						scope:recipient = { is_leader_in_war = prev }
					}
				}
			}
		}
	}

	populate_recipient_list = {
		scope:actor.top_liege = {
			every_vassal_or_below = {
				limit = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:recipient
						MINISTER_OF_WAR = scope:actor
					}
				}
				add_to_list = characters
			}
		}
	}

	can_send = {
	}

	on_send = {
	}
	
	is_highlighted = {
		scope:recipient = {
			is_at_war = yes
		}
	}

	auto_accept = yes

	on_accept = {
		scope:recipient = {
			# Save scopes for events
			save_scope_as = governor_at_war
			scope:secondary_recipient = { save_scope_as = governor_joining }

			# Have secondary_recipient join recipient's wars
			every_character_war = {
				limit = {
					scope:recipient = { is_leader_in_war = prev }
					is_attacker = scope:recipient
				}
				add_attacker = scope:secondary_recipient
			}
			every_character_war = {
				limit = {
					scope:recipient = { is_leader_in_war = prev }
					is_defender = scope:recipient
				}
				add_defender = scope:secondary_recipient
			}

			# If recipient is AI, add some opinion
			if = {
				limit = {
					is_ai = yes
				}
				add_opinion = {
					target = scope:actor
					modifier = grateful_opinion
					opinion = 10
				}
			}

			# Send recipient a letter event and let them know of your action
			if = {
				limit = {
					scope:actor != scope:recipient
				}
				trigger_event = {
					id = tgp_interaction_event.0015
				}
			}
		}

		scope:secondary_recipient = {
			# Send recipient a letter event and let them know of your action
			trigger_event = {
				id = tgp_interaction_event.0016
			}
		}

		scope:actor = {
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_neutral
					title = celestial_send_military_aid_confirmation
					left_icon = scope:recipient
					right_icon = scope:secondary_recipient

					custom_tooltip = celestial_send_military_aid_effect_desc
				}
			}
		}
	}

	on_decline = {
		# Interaction is auto accepted and cannot be declined
	}

	ai_targets = {
		ai_recipients = peer_vassals
		max = 30
	}
	ai_targets = {
		ai_recipients = vassals
		max = 30
	}
	ai_targets = { # So the minister of war can send aid to the hegemon
		ai_recipients = liege
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 8
		empire = 4
		hegemony = 3
	}

	ai_potential = {
		OR = {
			# If you are the minister of war
			has_title = title:e_minister_of_war
			# Or if you are an independent admin ruler with military governors
			AND = {
				top_liege = this
				government_allows = administrative
				government_allows = merit
				# But don't bother if you have the minister of war, he'll do it for you
				tgp_has_access_to_ministry_trigger = no
			}
		}
	}

	ai_will_do = {
		base = 0

		# Make sure to send aid if there is no one helping
		modifier = {
			add = 100
			scope:recipient = {
				vassal_contract_has_flag = celestial_civil_appointment
				any_war_ally = {
					count < 1
					this != scope:actor
				}
			}
		}
		
		# We'll make sure to send a bit more help to the hegemon (for immersion, more than he actually needing it)
		modifier = {
			add = 100
			scope:recipient = {
				top_liege = this
				any_war_ally = {
					count < 3
				}
			}
		}
		
		# We always want to send the grand marshal to the top liege
		modifier = {
			add = 100
			scope:recipient = {
				top_liege = this
			}
			scope:secondary_recipient = {
				has_title = title:e_minister_grand_marshal
			}
		}

		# Send more aid if recipient is weaker than the enemy side - But do so less frequently
		modifier = {
			add = 40
			scope:recipient = {
				any_character_war = {
					# Set up scope values so that we can compare strength
					save_temporary_scope_value_as = {
						name = ai_will_do_defender_strength
						value = 0
					}
					save_temporary_scope_value_as = {
						name = ai_will_do_attacker_strength
						value = 0
					}
					any_war_defender = {
						count = all
						save_temporary_scope_value_as = {
							name = ai_will_do_defender_strength
							value = {
								value = scope:ai_will_do_defender_strength
								add = current_military_strength
							}
						}
					}
					any_war_attacker = {
						count = all
						save_temporary_scope_value_as = {
							name = ai_will_do_attacker_strength
							value = {
								value = scope:ai_will_do_attacker_strength
								add = current_military_strength
							}
						}
					}
					# Check if actor's side is weaker than the opponent
					OR = {
						AND = {
							is_defender = scope:actor
							scope:ai_will_do_defender_strength < scope:ai_will_do_attacker_strength
						}
						AND = {
							is_attacker = scope:actor
							scope:ai_will_do_attacker_strength < scope:ai_will_do_defender_strength
						}
					}
				}
			}
		}
		
		# We always want to send the grand marshal to the top liege
		modifier = {
			factor = {
				value = 1
				if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_empire }
					}
					add = 3
				}
				else_if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_kingdom }
					}
					add = 2
				}
				else_if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_duchy }
					}
					add = 1.5
				}
			}
			scope:secondary_recipient = {
				is_at_war = no
			}
		}
		
		# Players get a bit of extra score if not already busy
		modifier = {
			factor = 2
			scope:secondary_recipient = {
				is_ai = no
				is_at_war = no
			}
		}
	}

	ai_accept = {
		base = 100 # Auto accepted/no reason to refuse
	}
}


become_tributary_interaction = {
	category = interaction_category_vassal
	common_interaction = no
	icon = become_tributary_interaction

	desc = become_tributary_interaction_desc

	is_shown = {
		scope:actor = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				current_military_strength < scope:recipient.one_and_a_half_times_current_military_strength
				primary_title.tier < scope:recipient.primary_title.tier
			}
		trigger_if = {
			limit = {
				scope:recipient = { has_title = title:h_china }

			}
			scope:actor = {
				custom_tooltip = {
				text = rd_neighbor_is_china
				is_tributary_or_independent_neighbor_of_china_trigger = yes
				}
			}
		}
		}
		scope:recipient = {
			is_independent_ruler = yes # while it's possible for tributaries to have their own tributaries, it should not be possible to create a tributary relationship with a non-independent ruler
			NOR = {
				this = scope:actor
				top_suzerain = scope:actor
			}
			can_have_tributaries_trigger = yes
		}
	}

	is_valid_showing_failures_only = {
			trigger_if = {
			limit = {
				scope:recipient = { government_has_flag = government_is_mandala }
				scope:actor = {
					OR = { 
						government_has_flag = government_is_tribal
						government_has_flag = government_is_mandala
					}
				}
			}
			always = yes
		}
		#Rulers who aren't Mandala or Tribal should really only be interested if you're big enough
		trigger_else = {
			custom_tooltip = {
				text = offer_tributarization_interaction_aibehavior_not_higher_rank
				scope:recipient.highest_held_title_tier >= scope:actor.highest_held_title_tier
			}
		}
		scope:actor = {
			is_physically_able = yes
			is_travelling = no
			NOT = { exists = involved_activity }
			is_confederation_member = no
			is_at_war = no
		}
		trigger_if = {
			limit = { scope:recipient = title:h_china.holder }
			scope:actor = {
				custom_tooltip = {
					text = neighbor_is_china
					is_tributary = no
					is_independent_ruler = yes
					OR = {
						has_variable = wants_to_become_tributary_of_china
						any_neighboring_and_across_water_top_liege_realm_owner = {
							primary_title = title:h_china
						}
					}
				}
			}		
		}
	}

	needs_confirmation = {
		scope:recipient = { highest_held_title_tier < tier_hegemony } # acknowledging a hegemon requires a tribute mission; open the decision UI instead of confirming acceptance
	}

	greeting = positive
	notification_text = BECOME_TRIBUTARY_INTERACTION_NOTIFICATION

	# Low starting obligations
	send_option = {
		flag = low_obligations
		localization = low_tributary_obligations
	}

	# Medium starting obligations
	send_option = {
		flag = normal_obligations
		localization = normal_tributary_obligations
		starts_enabled = { always = yes	}
	}

	# High starting obligations
	send_option = {
		flag = high_obligations
		localization = high_tributary_obligations
	}

	send_options_exclusive = yes

	on_send = {
		if = {
			limit = { scope:recipient = { highest_held_title_tier >= tier_hegemony } }
			open_view_data = {
				view = decision_detail
				data = decision:tribute_mission_decision
				player = scope:actor
			}
		}
	}

	on_accept = {
		if = {
			limit = { scope:recipient = { highest_held_title_tier < tier_hegemony } }
			scope:actor = {
				if = {
					limit = { is_tributary = yes }
					mandala_end_tributary_with_notification_effect = yes
				}
			}
			start_tributary_interaction_effect = {
				TRIBUTARY = scope:actor
				SUZERAIN = scope:recipient
			}
			scope:actor = {
				trigger_event = char_interaction.0360
			}
			scope:recipient = {
				if = {
					limit = { scope:high_obligations = yes }
					add_opinion = {
						modifier = tributary_volunteered_opinion
						target = scope:actor
						opinion = 20
					}
				}
				else_if = {
					limit = { scope:normal_obligations = yes }
					add_opinion = {
						modifier = tributary_volunteered_opinion
						target = scope:actor
					}
				}

				consume_all_criminal_reasons_effect = {
					LIEGE = scope:recipient
					CRIMINAL = scope:actor
				}
			}
		}
		else = {} # Do nothing if the recipient is hegemony-tier or higher; these require a tribute mission to establish
	}

	on_decline = {
		scope:actor = {
			trigger_event = char_interaction.0361
		}
	}

	is_available = {
		NOT = { government_has_flag = cannot_be_vassal_or_liege }
		top_liege = this # You have to be independent - This check exists to prevent a lot of edge-cases where you can change liege
		is_tributary = no #Mandalas can steal tributaries but tributaries will need to be asked to do so. On their own accord they may simply stop paying tribute to their current suzerain.
		is_confederation_member = no
	}

	ai_targets = {
		ai_recipients = neighboring_rulers_including_tributary_borders
		max = 5
	}

	ai_targets = {
		ai_recipients = neighboring_top_overlords_connected_by_land
	}

	# this might appear fairly frequent but is necessary in order to ensure AI can respond to sudden threats on their borders
	ai_frequency_by_tier = {
		barony = 0
		county = 6
		duchy = 6
		kingdom = 0
		empire = 0
		hegemony = 0
	}

	force_notification = yes

	ai_will_do = {
		base = -50
		#MINOR MODIFIERS
		ai_military_threat_modifier_with_cbs = {
			SENDER = scope:actor
			RECEIVER = scope:recipient
			MULTIPLIER = 1
		}
		#Obedience
		modifier = {
			is_obedient_to = scope:recipient
			add = 40
			desc = obedient_interaction_reason
		}
		# Rivalry modifier
		modifier = {
			desc = offer_vassalization_interaction_aibehavior_rival_tt
			trigger = {
				scope:actor = {
					has_relation_rival = scope:recipient
					NOT = { has_relation_nemesis = scope:recipient }
				}
			}
			add = -10
		}
		# Nemesis modifier
		modifier = {
			desc = offer_vassalization_interaction_aibehavior_nemesis_tt
			trigger = {
				scope:actor = {
					has_relation_nemesis = scope:recipient
				}
			}
			add = -100
		}
		# Different faith, no pluralism
		modifier = { 
			desc = offer_vassalization_interaction_aibehavior_differentfaith_tt
			trigger = {
				scope:actor = {
					NOR = { # Of two different faiths AND the potential vassal's faith is not pluralistic.
						faith = scope:recipient.faith
						faith = { has_doctrine = doctrine_pluralism_pluralistic }
					}
				}
			}
			add = {
				value = -25
				if = {
					limit = {
						scope:actor.faith = {
							faith_hostility_level = {
								target = scope:recipient.faith
								value >= faith_hostile_level
							}
						}
					}
					add = -10
				}
				if = {
					limit = {
						scope:actor.faith = {
							faith_hostility_level = {
								target = scope:recipient.faith
								value >= faith_evil_level
							}
						}
					}
					add = -25
				}
			}
		}
		# Cultural Acceptance
		modifier = { 
			scope:actor = {
				NOT = { # cultural condition below doesn't have to apply if both actor and recipient have nomadic_philosophy
					has_trait = nomadic_philosophy
					scope:recipient = { has_trait = nomadic_philosophy }
				}
				NOT = { has_same_culture_as = scope:recipient }
				culture = {
					cultural_acceptance = { target = scope:recipient.culture value < 50 }
				}
			}
			add = {
				add = -10
				if = {
					limit = { scope:actor.culture = { has_cultural_pillar = ethos_bellicose } }
					add = -10
				}
			}
			desc = cultural_acceptance_interaction_reason
		}
		# Same language
		modifier = { 
			add = 5
			desc = speaks_same_language_interaction_reason
			trigger = {
				scope:actor = {
					knows_language_of_culture = scope:recipient.culture
				}
			}
		}

		### MANDALA ###
		#Added threshold for Mandalas who already are Tributaries
		modifier = {
			scope:recipient = { is_tributary = yes }
			NOT = { scope:recipient.suzerain = scope:actor }
			scope:recipient.suzerain = { primary_title.tier = tier_duchy }
			add = -25
			desc = already_tributary_threshold
		}
		modifier = {
			scope:recipient = { is_tributary = yes }
			NOT = { scope:recipient.suzerain = scope:actor }
			scope:recipient.suzerain = { primary_title.tier = tier_kingdom }
			add = -50
			desc = already_tributary_threshold
		}
		modifier = {
			scope:recipient = { is_tributary = yes }
			NOT = { scope:recipient.suzerain = scope:actor }
			scope:recipient.suzerain = { primary_title.tier >= tier_empire }
			add = -75
			desc = already_tributary_threshold
		}
		#A devaraja should never willingly _offer_ to become a tributary
		modifier = {
			scope:actor = {
				government_has_flag = government_is_mandala
				OR = {
					has_unruined_mandala_capital_trigger = yes
					has_mandala_aspect_trigger = yes
					has_variable = mandala_godking
				}
			}
			add = -1000
		}
		#I am a Tribal! ... and you're a Mandala
		modifier = {
			scope:actor = { government_has_flag = government_is_tribal }
			scope:recipient = { government_has_flag = government_is_mandala }
			add = 30
			desc = actor_is_a_tribal_government
		}
		#Mandala Piety Level - this is only checked if you are not a Devaraja/haven't got a capital temple complex - Otherwise we use Radiance
		mandala_devaraja_piety_level_add_weight_modifier = { DEVARAJA = scope:recipient }
		#Recipient Radiance - Radiance Value x2
		modifier = {
			scope:recipient = { has_unruined_mandala_capital_trigger = yes }
			add = {
				value = scope:recipient.mandala_radiance_value
				multiply = 2
			}
			desc = recipient_positive_mandala_radiance
		}
		#Tributary Realm Size
		subject_realm_size_lose_weight_modifier = {
			DEVARAJA = scope:actor
			SUBJECT = scope:recipient
		}
		#Devaraja Mandala Capital
		mandala_devaraja_capital_add_weight_modifier = {
			DEVARAJA = scope:actor
			TRIBUTARY = scope:recipient
		}
		#Are they independent but a neighboring Mandala more Radiant than you?
		#We reduce acceptance by the radiance difference x2
		modifier = {
			trigger_if = {
				limit = {
					scope:recipient = { has_unruined_mandala_capital_trigger = yes }
					scope:actor = {
						is_tributary = no
						OR = {
							government_has_flag = government_is_mandala
							government_has_flag = government_is_tribal
						}
					}
				}
				scope:recipient = {
					OR = {
						any_neighboring_top_liege_realm_owner = {
							has_unruined_mandala_capital_trigger = yes
							government_has_flag = government_is_mandala
							NOR = { 
								this = scope:recipient
								this = scope:actor
							}
							save_temporary_scope_as = suzerain_comparison
						}
						any_neighboring_top_suzerain_realm_owner = {
							has_unruined_mandala_capital_trigger = yes
							government_has_flag = government_is_mandala
							NOR = { 
								this = scope:recipient
								this = scope:actor
							}
							save_temporary_scope_as = suzerain_comparison
						}
					}
				}	
				always = yes
			}
			trigger_else = { always = no }
			add = {
				#Double it as we would with your own radiance impact above and reduce acceptance by that value
				value = {
					value = scope:suzerain_comparison.mandala_radiance_value
					multiply = 2
				}
				multiply = -1
			}
			desc = other_devaraja_radiance
		}
		#Prosperity Decree
		modifier = {
			desc = is_prosperity_mandala_tributary
			scope:actor = {
				is_tributary = yes
				suzerain = { has_realm_law_flag = tributaries_less_likely_to_break_free }
			}
			add = 15
		}
		#SEA legacy
		modifier = {
			desc = tgp_sea_legacy_2_modifier_desc
			scope:recipient = {
				dynasty ?= {
					has_dynasty_perk = tgp_sea_legacy_2
				}
			}
			add = tgp_sea_legacy_tributary_acceptance_value
		}
		# I am higher rank than you
		modifier = { 
			desc = tributary_interaction_aibehavior_recipient_tier_tt
			trigger = {
				scope:actor = {
					highest_held_title_tier > scope:recipient.highest_held_title_tier
				}
			}
			add = {
				value = scope:actor.highest_held_title_tier
				subtract = scope:recipient.highest_held_title_tier 
				multiply = 50
				multiply = -1
			}
		}
		# Same Faith and Actor is a god King
		modifier = { 
			desc = embrace_as_tributary_interaction_same_faith
			scope:recipient = {
				faith = scope:actor.faith
				has_unruined_mandala_capital_trigger = yes
			}
			add = {
				value = 10
			}
		}
		# Different faith, no pluralism.
		modifier = { 
			desc = offer_vassalization_interaction_aibehavior_differentfaith_tt
			trigger = {
				scope:recipient = {
					faith = {
						NOR = { # Of two different faiths AND the potential tributary's faith is not pluralistic
							this = scope:actor.faith
							has_doctrine = doctrine_pluralism_pluralistic
						}
					}
				}
			}
			add = {
				value = -25
				if = {
					limit = {
						scope:recipient.faith = {
							faith_hostility_level = {
								target = scope:actor.faith
								value >= faith_hostile_level
							}
						}
					}
					add = -10
				}
				if = {
					limit = {
						scope:recipient.faith = {
							faith_hostility_level = {
								target = scope:actor.faith
								value >= faith_evil_level
							}
						}
					}
					add = -25
				}
			}
		}
		# Different religion Family - We prefer god kings to be vaguely within our own world view
		modifier = { 
			desc = embrace_as_tributary_interaction_other_religion_family
			scope:actor = { 	
				NOT = { government_has_flag = government_is_wanua }
			}
			scope:recipient.faith.religion = {
				switch = {
					trigger = is_in_family
					rf_pagan = {
						scope:actor.faith.religion = { NOT = { is_in_family = rf_pagan } }
					}
					rf_sinitic = {
						scope:actor.faith.religion = { NOT = { is_in_family = rf_sinitic } }
					}
					rf_eastern = {
						scope:actor.faith.religion = { NOT = { is_in_family = rf_eastern } }
					}
					rf_abrahamic = {
						scope:actor.faith.religion = { NOT = { is_in_family = rf_abrahamic } }
					}
				}
			}
			add = -25
		}
		# They are not Mandalas nor Tribes
		modifier = {
			trigger = {
				scope:recipient = {
					NOR = {
						government_has_flag = government_is_mandala
						government_has_flag = government_is_tribal
					}
				}
			}
			add = {
				value = -50
				#Would cause a lot of issues
				if = {
					limit = {
						scope:recipient = {
							OR = {
								government_allows = administrative
								government_is_japanese_trigger = yes
								government_has_flag = government_is_nomadic
							}
						}
					}
					subtract = 950 #Some governments are especially unlikely to agree
				}
				#Not radiant enough
				if = {
					limit = {
						scope:recipient = {
							government_has_flag = government_is_mandala
							has_unruined_mandala_capital_trigger = yes
							mandala_radiance_value <= 40
						}
					}
					subtract = 100
				}
			}
		}
		#Far away
		modifier = { 
			desc = offer_vassalization_interaction_aibehavior_remoterealm_tt
			trigger = {
				scope:recipient = {
					NOT = {
						any_land_neighboring_realm_with_tributaries_owner = {
							this = scope:actor
						}
					}
				}
				trigger_if = { #Islands we can get farther away
					limit = {
						scope:actor.capital_county = { is_coastal_county = yes }
						any_sub_realm_county = { is_coastal_county = yes }
					}
					scope:actor.capital_province = { squared_distance = { target = scope:recipient.capital_province value >= squared_distance_huge } }
				}
				trigger_else = { #Inland is harder
					scope:actor.capital_province = { squared_distance = { target = scope:recipient.capital_province value >= squared_distance_major } }
				}
			}
			add = -250
		}
		#Legitimacy
			modifier = {
				desc = "LOW_LEGITIMACY_REASON"
				add = -15
				scope:recipient = {
					has_legitimacy_flag = slightly_reduced_tributarization_acceptance
				}
			}
			modifier = {
				desc = "LOW_LEGITIMACY_REASON"
				add = -25
				scope:recipient = {
					has_legitimacy_flag = reduced_tributarization_acceptance
				}
			}
			modifier = {
				desc = "LOW_LEGITIMACY_REASON"
				add = -50
				scope:recipient = {
					has_legitimacy_flag = very_reduced_tributarization_acceptance
				}
			}
			modifier = {
				desc = "LOW_LEGITIMACY_REASON"
				add = -75
				scope:recipient = {
					has_legitimacy_flag = massively_reduced_tributarization_acceptance
				}
			}
		# HIGH LEGITIMACY
			modifier = {
				desc = "HIGH_LEGITIMACY_REASON"
				add = 25
				scope:recipient = {
					has_legitimacy_flag = increased_tributarization_acceptance
				}
			}
			modifier = {
				desc = "HIGH_LEGITIMACY_REASON"
				add = 50
				scope:recipient = {
					has_legitimacy_flag = very_increased_tributarization_acceptance
				}
			}
			modifier = {
				desc = "HIGH_LEGITIMACY_REASON"
				add = 75
				scope:recipient = {
					has_legitimacy_flag = extra_increased_tributarization_acceptance
				}
			}
		# OPINION INFLUENCE
		opinion_modifier = { # Compare Opinion modifier.
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = 1
		}
	}

	ai_min_reply_days = 5
	ai_max_reply_days = 10

	auto_accept = { scope:recipient = { highest_held_title_tier >= tier_hegemony } } # Hegemons always "accepts", but this only opens the Tribute Mission UI

	ai_accept = {
		base = 50

		modifier = {
			desc = interaction_is_nomadic
			scope:recipient = {
				government_has_flag = government_is_nomadic
			}
			add = 100
		}

		modifier = {  # Can't flee the conqueror this way
			add = -1000
			desc = NO_FRIVOLOUS_ACTIVITIES_REASON
			scope:actor = { has_variable = conqueror }
		}

		modifier = { # Wide difference in rank
			desc = offer_vassalization_interaction_aibehavior_widetitletier_tt
			trigger = {
				scope:actor = {
					tier_difference = {
						target = scope:recipient
						value > 1
					}
				}
			}
			add = 20
		}
		modifier = { # Distant Realm.
			desc = offer_vassalization_interaction_aibehavior_distantrealm_tt
			trigger = {
				scope:actor = {
					NOT = {
						any_neighboring_top_liege_realm_owner = { this = scope:recipient }
					}
				}
				scope:actor.capital_province = { squared_distance = { target = scope:recipient.capital_province value < squared_distance_major } }
			}
			add = -15
		}
		modifier = { # Remote Realm.
			desc = offer_vassalization_interaction_aibehavior_remoterealm_tt
			trigger = {
				scope:actor = {
					NOT = {
						any_neighboring_top_liege_realm_owner = { this = scope:recipient }
					}
				}
				scope:actor.capital_province = { squared_distance = { target = scope:recipient.capital_province value >= squared_distance_major } }
			}
			add = -25
		}

		# MINOR
			modifier = { # Rivalry modifier.
				desc = offer_vassalization_interaction_aibehavior_rival_tt
				trigger = {
					scope:recipient = {
						has_relation_rival = scope:actor
						NOT = { has_relation_nemesis = scope:actor }
					}
				}
				add = -10
			}
			modifier = { # Nemesis modifier.
				desc = offer_vassalization_interaction_aibehavior_nemesis_tt
				trigger = {
					scope:recipient = {
						has_relation_nemesis = scope:actor
					}
				}
				add = -100
			}
			modifier = { # Same Dynasty modifier.
				desc = offer_vassalization_interaction_aibehavior_dynasty_tt
				trigger = {
					scope:recipient = {
						dynasty = scope:actor.dynasty
					}
				}
				add = 10
			}

		# PERSONALITY
		ai_value_modifier = {
			ai_greed = 0.75
			min = 0
		}

		# OPINION INFLUENCE
		opinion_modifier = { # Compare Opinion modifier.
			trigger = {
				NOT = { 
					scope:recipient = { government_has_flag = government_is_mandala }
				}
			}
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 1
		}

		# CONTRACT OPTIONS
		modifier = {
			add = -25
			scope:low_obligations = yes
			desc = CONTRACT_LOW_TRIBUTARY_TAXES_REASON
		}
		modifier = {
			add = 25
			scope:high_obligations = yes
			desc = CONTRACT_HIGH_TRIBUTARY_TAXES_REASON
		}
	}
}

# Dismiss your Disciple - for Player only
break_with_disciple = {
	icon = icon_cross
	interface_priority = 50
	category = interaction_category_hostile
	common_interaction = no
	desc = break_with_disciple_desc

	is_shown = {
		scope:actor = {
			has_relation_disciple = scope:recipient
		}
	}

	auto_accept = yes

	on_accept = {
		scope:actor = {
			remove_relation_disciple = scope:recipient
			if = {
				limit = {
			
					
					highest_held_title_tier > tier_empire
					
				}
				scope:recipient = {
				remove_character_modifier = rd_han_tianzi_mensheng_modifier
				}
			}
			if = {
				limit = {
	
					
					highest_held_title_tier = tier_empire
					OR = {
						is_independent_ruler = yes
						vassal_contract_has_flag = rd_admin_theme_imperial
					}
					
				}
				scope:recipient = {
				remove_character_modifier = rd_han_junwang_mensheng_modifier
				}
			}
			
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = refused_to_be_elder_opinion
				opinion = -20
			}
			trigger_event = tgp_interaction_event.0032
		}
	}
}

break_with_elder = {
	icon = icon_cross
	interface_priority = 50
	category = interaction_category_hostile
	common_interaction = no
	desc = break_with_elder_desc

	is_shown = {
		scope:actor = {
			has_relation_elder = scope:recipient
		}
	}

	auto_accept = yes

	on_accept = {
		scope:actor = {
			remove_relation_elder = scope:recipient
		}
		scope:recipient = {
			if = {
				limit = {
			
					
					highest_held_title_tier > tier_empire
					
				}
				scope:actor = {
				remove_character_modifier = rd_han_tianzi_mensheng_modifier
				}
			}
			if = {
				limit = {
	
					
					highest_held_title_tier = tier_empire
					OR = {
						is_independent_ruler = yes
						vassal_contract_has_flag = rd_admin_theme_imperial
					}
					
				}
				scope:actor = {
				remove_character_modifier = rd_han_junwang_mensheng_modifier
				}
			}
			add_opinion = {
				target = scope:actor
				modifier = refused_to_be_disciple_opinion
				opinion = -50
			}
			trigger_event = tgp_interaction_event.0030
		}
	}

	ai_targets = {
		ai_recipients = scripted_relations
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 120
		duchy = 60
		kingdom = 60
		empire = 60
		hegemony = 60
	}

	ai_potential = {
		num_of_relation_elder > 0
	}

	ai_will_do = {
		base = 0

		# Opinion
		opinion_modifier = {
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = -0.5
		}

		# Personal reasons
		modifier = {
			add = -50
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}
		modifier = {
			add = 50
			has_relation_rival = scope:recipient
		}

		# Political reasons
		modifier = { # More likely to stop being a disciple if actor is a movement leader
			add = 20
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:actor
				}
			}
		}
		modifier = { # Elder is no longer part of the same realm (but we ignore this if we are in the chaose phase)
			add = 20
			top_liege != scope:recipient.top_liege
			NAND = {
				any_character_situation = { situation_type = dynastic_cycle }
				situation:dynastic_cycle ?= {
					situation_current_phase = situation_dynastic_cycle_phase_chaos
				}
			}
		}
	}
}

exact_tribute_interaction = {
	category = interaction_category_vassal
	icon = demand_tributary_interaction

	ai_maybe = yes
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	can_send_despite_rejection = yes
	popup_on_receive = yes
	common_interaction = yes

	interface_priority = 4

	ai_targets = {
		ai_recipients = tributaries
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 12
		duchy = 9
		kingdom = 6
		empire = 6
		hegemony = 6
	}

	desc = exact_tribute_interaction_desc

	is_shown = {
		scope:recipient = { is_ai = yes }
		scope:actor = {
			OR = {
				highest_held_title_tier >= tier_hegemony
				AND = {
					government_has_flag = government_is_mandala
					scope:recipient = { is_tributary_of = scope:actor }
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		trigger_if = {
			limit = {
				scope:actor = {
				has_title = title:h_china
				}
			}
			scope:recipient = {
			custom_tooltip = {
						text = rd_exact_tribute_law_switch
				is_tributary_or_independent_neighbor_of_china_trigger = yes
				}
			}
		}
		scope:recipient = {
			is_physically_able = yes
			is_adult = yes
			#Has recently gone on a Tribute Mission (to you)
			custom_tooltip = {
				text = exact_tribute_interaction_recently_tribute_missioned_tt
				NOT = { var:tribute_mission_grace ?= scope:actor }
			}

			trigger_if = {
				limit = {
					scope:actor = {
						highest_held_title_tier >= tier_hegemony
					}
				}
				scope:recipient = {
					trigger_if = {
						limit = { is_tributary_of = scope:actor }
						subject_standing < exact_tribute_subject_standing_value
					}
					trigger_else = {
						is_independent_ruler = yes
						highest_held_title_tier < tier_hegemony
						is_tributary = no
						custom_tooltip = {
							text = exact_tribute_interaction_hegemony_not_neighbor_tt
							any_neighboring_and_across_water_top_liege_realm_owner = {
								this = scope:actor
							}
						}
					}
				}
			}
			trigger_else = {
				scope:actor = { government_has_flag = government_is_mandala }
				scope:recipient = { is_tributary_of = scope:actor }
			}

			#Has something to offer as Tribute Mission
			trigger_if = {
				limit = {
					NOR = {
						var:declined_requested_tribute_recently ?= scope:actor
						var:requested_tribute_mission ?= scope:actor
					}
				}
				custom_tooltip = {
					text = exact_tribute_interaction_no_tribute_tt
					OR = {
						has_gold_tribute_trigger = yes
						has_herd_tribute_trigger = yes
						has_artifact_tribute_trigger = yes
						AND = {
							any_courtier_or_guest = {
								can_become_concubine_of_character_valid_trigger = { CHARACTER = scope:actor }
							}
							scope:actor = { allowed_more_concubines = yes }
						}
						AND = {
							has_eunuch_tribute_trigger = yes
							scope:actor = { 
								culture = { has_cultural_parameter = can_appoint_chief_eunuch }
							}
						}
					}
				}
			}
			#Has recently refused
			custom_tooltip = {
				text = exact_tribute_interaction_recently_refused_tt
				NOT = { var:declined_requested_tribute_recently ?= scope:actor }
			}
			#Is already engaged
			custom_tooltip = {
				text = exact_tribute_interaction_already_engaged_tt
				NOR = { 
					var:requested_tribute_mission ?= scope:actor
					has_variable = tribute_mission_type
				}
			}
		}
	}

	greeting = positive
	notification_text = EXACT_TRIBUTE_INTERACTION_NOTIFICATION

	#Request Gold
	send_option = {
		flag = gold
		is_valid = {
			scope:recipient ?= { has_gold_tribute_trigger = yes }
		}
		localization = request_gold_tribute
	}

	#Request Herd
	send_option = {
		flag = herd
		is_valid = {
			scope:recipient ?= { has_herd_tribute_trigger = yes }
		}
		localization = request_herd_tribute
	}

	#Request Artifact
	send_option = {
		flag = artifact
		is_valid = {
			scope:recipient = { 
				custom_tooltip = {
					text = exact_tribute_interaction_no_suitable_artifact_tt
					has_artifact_tribute_trigger = yes 
				}
			}
		}
		localization = request_artifact_tribute
	}
	
	#Request Concubine
	send_option = {
		flag = concubine
		is_valid = {
			scope:actor = {
				can_have_concubines_trigger = { CHAR = scope:actor }
			}
			scope:recipient = { 
				custom_tooltip = {
					text = exact_tribute_interaction_no_suitable_concubine_tt
					any_courtier_or_guest = {
						can_become_concubine_of_character_valid_trigger = { CHARACTER = scope:actor }
					}
				}
			}
		}
		localization = request_concubine_tribute
	}

	#Request Eunuch
	send_option = {
		flag = eunuch
		is_valid = {
			trigger_if = {
				limit = { 
					scope:actor = { 
						can_employ_court_eunuchs_trigger = { CHAR = scope:actor }
					}
				}
				scope:recipient = { 
					custom_tooltip = {
						text = exact_tribute_interaction_no_suitable_eunuchs_tt
						has_eunuch_tribute_trigger = yes 
					}
				}
			}
			trigger_else = {
				scope:actor = {
					can_employ_court_eunuchs_trigger = { CHAR = scope:actor }
				} 
			}
		}
		localization = request_eunuch_tribute
	}

	send_options_exclusive = yes

	on_accept = {
		scope:actor = {
			if = {
				limit = { is_ai = no }
				trigger_event = tribute_mission.9010
			}
		}
		scope:recipient = {
			set_variable = {
				name = requested_tribute_mission
				value = scope:actor
				years = requested_tribute_mission_deadline_years
			}
			trigger_event = {
				id = tribute_mission.9500
				years = requested_tribute_mission_deadline_years
			}
			switch = {
				trigger = yes
				scope:gold ?= {
					set_variable = {
						name = requested_tribute_mission_type_gold
						years = requested_tribute_mission_deadline_years
					}	
					custom_tooltip = exact_tribute_interaction_gold_tt
				}
				scope:herd ?= {
					set_variable = {
						name = requested_tribute_mission_type_herd
						years = requested_tribute_mission_deadline_years
					}
					custom_tooltip = exact_tribute_interaction_herd_tt
				}
				scope:artifact ?= {
					set_variable = {
						name = requested_tribute_mission_type_artifact
						years = requested_tribute_mission_deadline_years
					}
					custom_tooltip = exact_tribute_interaction_artifact_tt
					random_character_artifact = { 
						limit = { is_suitable_artifact_tribute_trigger = yes }
						scope:recipient = {
							set_variable = {
								name = predetermined_artifact_tribute
								value = prev
							}
						}
					}
				}
				scope:concubine ?= {
					set_variable = {
						name = requested_tribute_mission_type_concubine
						years = requested_tribute_mission_deadline_years
					}
					custom_tooltip = exact_tribute_interaction_concubine_tt
					every_courtier_or_guest = {
						limit = {
							can_be_offered_as_concubine_to_character_trigger = {
								GIVER = scope:recipient
								CHARACTER = scope:actor
							}
							is_adult = yes
							has_any_disease_trigger = no
							has_easily_mocked_physical_attribute_trigger = no
						}
						add_to_list = potential_concubine_tribute_list
						random_in_list = {
							list = potential_concubine_tribute_list
							weight = {
								#Let's try to make a sane choice here
								base = 0
								#No marginally relevant court people
								modifier = {
									add = 10
									NOR = {
										is_councillor = yes
										has_any_court_position = yes
									}
								}
								#No knights
								modifier = {
									add = 5
									is_knight = no
								}
								#No inspired people?
								modifier = {
									add = 20
									NOT = { exists = inspiration }
								}
								#No close family
								modifier = {
									add = 15
									NOT = { is_close_or_extended_family_of = scope:recipient }
								}
								#No friends?
								modifier = {
									add = 20
									NOT = { has_relation_friend = scope:recipient }
								}
								#No children
								modifier = {
									add = 25
									NOT = { is_child_of = scope:recipient }
								}
							}
							scope:recipient = {
								set_variable = {
									name = predetermined_concubine_tribute
									value = prev
								}
							}
						}
					}
				}
				scope:eunuch ?= {
					set_variable = {
						name = requested_tribute_mission_type_eunuch
						years = requested_tribute_mission_deadline_years
					}
					custom_tooltip = exact_tribute_interaction_eunuch_tt
					every_courtier = {
						limit = { 
							tribute_mission_is_available_eunuch_trigger = yes
							NAND = {
								faith = { has_doctrine = doctrine_theocracy_temporal }
								this = scope:actor.cp:councillor_court_chaplain
							}
							has_any_disease_trigger = no
						}
						add_to_list = potential_eunuch_tribute_list
						random_in_list = {
							list = potential_eunuch_tribute_list
							weight = {
								#Let's try to make a sane choice here
								base = 0
								#No marginally relevant court people
								modifier = {
									add = 10
									NOR = {
										is_councillor = yes
										has_any_court_position = yes
									}
								}
								#No knights
								modifier = {
									add = 5
									is_knight = no
								}
								#No inspired people?
								modifier = {
									add = 20
									NOT = { exists = inspiration }
								}
								#No close family
								modifier = {
									add = 15
									NOT = { is_close_or_extended_family_of = scope:recipient }
								}
								#No friends?
								modifier = {
									add = 20
									NOT = { has_relation_friend = scope:recipient }
								}
								#No children
								modifier = {
									add = 25
									NOT = { is_child_of = scope:recipient }
								}
							}
							scope:recipient = {
								set_variable = {
									name = predetermined_eunuch_tribute
									value = prev
								}
							}
						}
					}
				}
			}
			if = {
				limit = { scope:actor = { government_has_flag = government_is_mandala } }
				execute_decision = tribute_mission_decision_mandala
			}
			else_if = {
				limit = { scope:actor.primary_title = title:h_china }
				execute_decision = tribute_mission_decision_china
			}
			else_if = {
				limit = { scope:actor.primary_title = title:h_roman_empire }
				execute_decision = tribute_mission_decision_roman_empire
			}
			else_if = {
				limit = { scope:actor.primary_title = title:h_eastern_roman_empire }
				execute_decision = tribute_mission_decision_eastern_roman_empire
			}
			else_if = {
				limit = { scope:actor.primary_title = title:h_dar_al_islam }
				execute_decision = tribute_mission_decision_dar_al_islam
			}
			else_if = {
				limit = { scope:actor.primary_title = title:h_india }
				execute_decision = tribute_mission_decision_india
			}
		}
	}

	on_decline = {
		scope:recipient = {
			if = {
				limit = { has_legitimacy = yes }
				add_legitimacy = minor_legitimacy_loss
			}
			set_variable = {
				name = declined_requested_tribute_recently
				value = scope:actor
				years = requested_tribute_mission_deadline_years
			}
			if = {
				limit = { is_ai = yes }
				add_opinion = {
					modifier = declined_tribute_mission_opinion
					opinion = -30
					target = scope:actor
				}
			}
		}
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				add_opinion = {
					modifier = declined_tribute_mission_opinion
					opinion = -30
					target = scope:recipient
				}
			}
			if = {
				limit = { is_ai = no }
				trigger_event = tribute_mission.9000
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 50
		modifier = {
			scope:actor = { has_realm_law = mandala_decree_reverence }
			factor = 2
		}
		modifier = {
			NOT = { ai_boldness = 0 }
			add = {
				value = ai_boldness
				divide = 4
			}
			desc = TRIBUTARY_BOLDNESS_REASON
		}
		modifier = {
			ai_greed > 0
			add = {
				value = ai_greed
				divide = 4
			}
			desc = TRIBUTARY_GREED_REASON
		}
	
	}

	ai_accept = {
		base = 0
		#Base
		modifier = {
			government_has_flag = government_is_mandala
			add = -25
			desc = base_with_value
		}
		modifier = { # Special case for Hegemonic Tributaries
			scope:actor = {
				highest_held_title_tier >= tier_hegemony
			}
			add = {
				add = 25
				if = {
					limit = { 
						OR = {
							NOT = { scope:recipient.primary_title = title:h_china } 
							government_has_flag = government_is_meritocratic
						}
					}
					add = 25
				}
			}
			desc = tributary_interaction_aibehavior_recipient_hegemon_tier_tt
		}

		modifier = { # Special case for Hegemonic Tributaries in the Dynastic Cycle - Stable Phase
			scope:actor = {
				highest_held_title_tier >= tier_hegemony
				any_character_situation = {
					situation_type = dynastic_cycle
				}
			}
			add = {
				if = { # Unstable Phase
					limit = {
						any_character_situation = {
							situation_type = dynastic_cycle
							OR = {
								situation_current_phase = situation_dynastic_cycle_phase_instability
								situation_current_phase = situation_dynastic_cycle_phase_instability_conquest
							}
						}
					}
					add = -50
					desc = tributary_interaction_aibehavior_recipient_unstable_cycle_tt
				}
				else = { # Stable Phase
					if = {
						limit = {
							scope:actor.legitimacy_level < dynastic_cycle_legitimacy_expectation
						}
						add = -25
						desc = tributary_interaction_aibehavior_recipient_low_legitimacy_tt
					}
					else_if = {
						limit = {
							scope:actor.legitimacy_level > dynastic_cycle_legitimacy_expectation
						}
						add = 25
						desc = tributary_interaction_aibehavior_recipient_high_legitimacy_tt
					}
				}
			}
			desc = ai_will_do_debug # For debugging, not shown to players
		}

		#MINOR MODIFIERS
		modifier = { # the bolder they are, the less likely they will agree to this and the more cowardly the more likely
			NOT = { ai_boldness = 0 }
			add = {
				value = ai_boldness
				multiply = -1
				divide = 4
			}
			desc = TRIBUTARY_BOLDNESS_REASON
		}

		modifier = { # the greedier they are, the less likely they will agree to this
			ai_greed > 0
			add = {
				value = ai_greed
				multiply = -1
				divide = 4
			}
			desc = TRIBUTARY_GREED_REASON
		}
		modifier = { # Rivalry modifier.
			desc = embrace_tributarization_interaction_aibehavior_rival_tt
			trigger = {
				scope:recipient = {
					has_relation_rival = scope:actor
					NOT = { has_relation_nemesis = scope:actor }
				}
			}
			add = -30
		}
		modifier = { # Nemesis modifier.
			desc = embrace_tributarization_interaction_aibehavior_nemesis_tt
			trigger = {
				scope:recipient = {
					has_relation_nemesis = scope:actor
				}
			}
			add = -100
		}
		modifier = { # Same Dynasty modifier.
			desc = embrace_tributarization_interaction_aibehavior_dynasty_tt
			trigger = {
				scope:recipient = {
					dynasty = scope:actor.dynasty
				}
			}
			add = 10
		}
		#Prosperity Mandala
		modifier = {
			desc = is_prosperity_mandala_tributary
			scope:recipient = {
				is_tributary = yes
				suzerain = { has_realm_law = mandala_decree_prosperity }
			}
			add = 15
		}
		#Mandala Piety Level
		#This is only checked if you are not a Devaraja/haven't got a capital temple complex - Otherwise we use Radiance
		mandala_devaraja_piety_level_add_weight_modifier = { DEVARAJA = scope:actor }

		#Your Radiance
		modifier = {
			scope:actor = { has_unruined_mandala_capital_trigger = yes }
			add = {
				value = scope:actor.mandala_radiance_value
				multiply = 2
			}
			desc = actor_positive_mandala_radiance
		}
		opinion_modifier = { # Compare Opinion modifier.
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 1
		}

  		# if the actor is a major threat to the recipient they're more likely to accept
		ai_military_threat_modifier = {
			SENDER = scope:recipient
			RECEIVER = scope:actor
			MULTIPLIER = 1
		}
	}
}